extends ../../layouts/default.pug

include ../../mixins/filter-status.pug
include ../../mixins/search.pug
include ../../mixins/pagination.pug
include ../../mixins/form-change-multi.pug
include ../../mixins/alert.pug
include ../../mixins/limitItem.pug
include ../../mixins/sortItem.pug
include ../../mixins/moment.pug

block main
  if (role.permissions.includes('blogs_view'))
    +alert-error(5000)
    +alert-success(5000)

    h1 Danh sách bài viết
    
    .card.mb-3
      .card-header Bộ lọc và Tìm kiếm
      .card-body
        .row
        
          .col-6
            +filterStatus(filterStatus)

          .col-6  
            +search(keyword)

    .card.mb-3 
      .card-header Sắp xếp bài viết   
      .card-body
        .row
          .col-2
            +sortItem("blogs")

    .card.mb-3
      .card-header Danh sách bài viết   
        .card-body
          .row
            .col-md-6.d-flex 
              if (role.permissions.includes('blogs_edit')) 
                +form-change-multi(`${prefixAdmin}/blogs/change-multi?_method=PATCH`, "delete-all")
              .ml-2
                +limitItem(prefixAdmin)


            .col-6.d-flex
              .ml-auto
                if (role.permissions.includes('blogs_create'))
                  a(
                    href=`${prefixAdmin}/blogs/create` 
                    class="btn btn-outline-success"
                  ) + thêm mới
                a(
                  href=`${prefixAdmin}/blogs/trash`
                  class="btn btn-outline-primary"
                )
                  i(class="fas fa-trash")

        table(
          class="table table-hover table-sm"
          checkbox-multi
        )
          thead
            tr
              th
                if (role.permissions.includes('blogs_edit'))   
                  input(type="checkbox" name="checkall")
              th STT
              th Hình ảnh
              th Tiêu đề
              th Vị trí
              th Mô tả
              th Nội dung
              th Trạng thái
              th Người tạo/ thời gian tạo
              th Người sửa/ thời gian sửa
              th Hành động

          tbody
            each item, index in blogs 
              tr
                td 
                  if (role.permissions.includes('blogs_edit')) 
                    input(
                      type="checkbox" 
                      name="id"
                      value=item.id
                    )
                td #{((pagination.currentPage - 1) * pagination.limitItem) + (index + 1)}
                td
                  img(
                    src=item.thumbnail
                    alt=item.title
                    width="100px"
                    height="auto"
                  )
                td #{item.title}
                td 
                  input(
                    type="number" 
                    value=item.position
                    style="width: 60px;"
                    min="1"
                    name="position"
                  )
                td !{item.description}
                td !{item.content}
                td
                  if (role.permissions.includes('blogs_edit'))
                    if(item.status == "active")
                      a(
                        href="javascript:;"
                        data-id=item.id 
                        data-status=item.status
                        button-change-status 
                        class="badge badge-success"
                      ) Hoạt động
                    else 
                      a(
                        href="javascript:;" 
                        data-id=item.id 
                        data-status=item.status
                        button-change-status 
                        class="badge badge-danger"
                      ) Dừng hoạt động
                  else 
                    if(item.status == "active")
                      span(
                        class="badge badge-success"
                      ) Hoạt động
                    else
                      span(
                        class="badge badge-danger"
                      ) Dừng hoạt động
                td 
                  if (item.createdBy && item.createdBy.account_id)
                    p #{item.createdBy.accountFullName} 
                    p 
                      +formatDate(item.createdBy.createdAt)
                td 
                  if (item.updatedBy && item.updatedBy.length > 0)
                    - const userUpdateBy = item.updatedBy[item.updatedBy.length - 1]
                    p #{userUpdateBy.accountFullName}
                    p 
                      +formatDateTime(userUpdateBy.updatedAt)

                td
                  a(
                    href=`${prefixAdmin}/blogs/detail/${item.id}`
                    class="btn btn-secondary btn-sm"
                  ) Chi tiết
                  if (role.permissions.includes('blogs_edit'))
                    a(
                      href=`${prefixAdmin}/blogs/edit/${item.id}`
                      class="btn btn-warning btn-sm"
                    ) Sửa
                  if (role.permissions.includes('blogs_delete'))
                    button(
                      data-id=item.id
                      button-delete-item
                      class="btn btn-danger btn-sm ml-1"
                    ) Xóa
    
    +pagination(pagination)

    if (role.permissions.includes('blogs_edit'))
      form(
        action="", 
        method="POST"
        id="form-change-status"
        data-path=`${prefixAdmin}/blogs/change-status`
      ) 

    if (role.permissions.includes('blogs_delete'))
      form(
        action="", 
        method="POST"
        id="form-delete-item"
        data-path=`${prefixAdmin}/blogs/deleteItem`
      ) 

    script(src="/admin/js/product.js")
  else 
    p Bạn không được cấp quyền xem danh sách bài viết!