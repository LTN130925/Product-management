extends ../../layouts/default.pug

include ../../mixins/alert.pug
include ../../mixins/form-change-multi.pug
include ../../mixins/filter-status.pug
include ../../mixins/search.pug

block main
  if (role.permissions.includes('users_view')) 
    +alert-success(5000)
    +alert-error(5000)

    h1(class="mb-4") Danh sách người dùng

    .card.mb-3
      .card-header Bộ lọc và Tìm kiếm
      .card-body
        .row
          .col-6
            +filterStatus(filterStatus)

          .col-6
            +search(keyword)

    .card.mb-3
      .card-header Danh sách
      .card-body
        .row
          .col-md-6.d-flex
            if (role.permissions.includes('users_edit')) 
              +form-change-multi(`${prefixAdmin}/users/change-multi?_method=PATCH`, "users")

        table(
          class="table table-hover table-sm"
          checkbox-multi
        )
          thead
            tr
              th
                if (role.permissions.includes('users_edit'))   
                  input(type="checkbox" name="checkall")
              th STT
              th Avatar
              th Họ tên
              th Số điện thoại
              th Email
              th Trạng thái
              th Hành động
            
            tbody
              each item, index in records
                tr
                  td 
                    if (role.permissions.includes('users_edit')) 
                      input(
                        type="checkbox" 
                        name="id"
                        value=item.id
                      )
                  td #{index + 1}
                  td
                    img(
                      src=item.avatar
                      alt=item.fullName
                      width="100px"
                      height="auto"
                    )
                  td #{item.fullName}
                  td #{item.phone || "Không có"}
                  td #{item.email}
                  td
                    if (role.permissions.includes('users_edit'))
                      if(item.status == "active")
                        a(
                          href="javascript:;"
                          data-id=item.id 
                          data-status=item.status
                          button-change-status 
                          class="badge badge-success"
                        ) Hoạt động
                      else 
                        a(
                          href="javascript:;" 
                          data-id=item.id 
                          data-status=item.status
                          button-change-status 
                          class="badge badge-danger"
                        ) Dừng hoạt động
                    else 
                      if(item.status == "active")
                        span(
                          class="badge badge-success"
                        ) Hoạt động
                      else
                        span(
                          class="badge badge-danger"
                        ) Dừng hoạt động
                  td 
                    a(
                      href=`${prefixAdmin}/users/detail/${item.id}`
                      class="btn btn-secondary btn-sm"
                    ) Chi tiết
                    if (role.permissions.includes('users_delete')) 
                      button(
                        data-id=item.id
                        button-delete-item
                        class="btn btn-danger btn-sm ml-1"
                      ) Xóa

    if (role.permissions.includes('users_edit')) 
      form(
        action="", 
        method="POST"
        id="form-change-status"
        data-path=`${prefixAdmin}/users/change-status`
      )

    if (role.permissions.includes('users_delete')) 
      form(
        action="", 
        method="POST"
        id="form-delete-item"
        data-path=`${prefixAdmin}/users/delete`
      ) 

    script(src="/admin/js/product.js")
  else 
    p Bạn không được phép truy cập và danh sách người dùng!



        
